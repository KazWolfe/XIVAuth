<% client_application = @preflight.client_application %>

<%= render partial: 'oauth/authorizations/auth_card_header',
           locals: { client_application: client_application, action_prefix: "Can't connect to" } %>
<div class="card-body">
  <main role="main">
    <% if @preflight.errors[:app_errors].any? %>
      <p>The application has been improperly configured and needs to be corrected. Identified problems:</p>
      <li>
        <% @preflight.errors[:app_errors].each do |error| %>
          <p>App <%= error %></p>
        <% end %>
      </li>
    <% elsif @preflight.errors[:user_errors].any? %>
      <p>
        Your XIVAuth account cannot log in to this app at this time. Please correct the problems listed below and try
        your request again.
      </p>

      <ul class="list-unstyled mb-0">
        <% @preflight.errors.where(:user_errors).each do |error| %>
          <% if lookup_context.template_exists?("user_#{error.type}", ['oauth/authorizations/preflight_errors'], true) %>
            <%= render partial: "oauth/authorizations/preflight_errors/user_#{error.type}" %>
          <% else %>
            <%= render partial: "oauth/authorizations/preflight_errors/generic",
                       locals: { error_title: "Precondition failed", error_message: error.message } %>
          <% end %>
        <% end %>
      </ul>
    <% end %>
  </main>
</div>
<div class="card-footer bg-transparent pt-0">
  <div class="d-grid">
    <a href="/" class="btn btn-primary d-block">Back to Safety</a>
  </div>
</div>
