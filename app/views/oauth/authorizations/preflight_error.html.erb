<% client_application = @preflight.client_application %>

<%= render partial: 'oauth/authorizations/auth_card_header',
           locals: { client_application: client_application, action_prefix: "Can't connect to" } %>
<div class="card-body">
  <main role="main">
    <% if @preflight.errors[:oauth_client].any? %>
      <p>
        The application has been improperly configured and needs to be corrected. The following misconfigurations have
        been identified.
      </p>
      <ul>
        <% @preflight.errors[:oauth_client].each do |error| %>
          <li class="d-flex align-items-start">
            <i class="bi bi-exclamation-triangle text-warning me-3" aria-hidden="true"></i>
            <div>
              <span>OAuth client <%= error %></span>
            </div>
          </li>
        <% end %>
      </ul>
      <p class="text-warning">Please contact the developer of this app to resolve this problem.</p>
    <% elsif @preflight.errors[:user].any? %>
      <p>
        Your XIVAuth account cannot log in to this app at this time. Please correct the problems listed below and try
        your request again.
      </p>

      <ul class="list-unstyled mb-0">
        <% @preflight.errors.where(:user).each do |error| %>
          <% if lookup_context.template_exists?("user_#{error.type}", ['oauth/authorizations/preflight_errors'], true) %>
            <%= render partial: "oauth/authorizations/preflight_errors/user_#{error.type}" %>
          <% else %>
            <%= render partial: "oauth/authorizations/preflight_errors/generic",
                       locals: { error_title: "Precondition failed", error_message: error.message } %>
          <% end %>
        <% end %>
      </ul>
    <% end %>
  </main>
</div>
<div class="card-footer bg-transparent pt-0">
  <div class="d-grid">
    <a href="/" class="btn btn-primary d-block">Back to Safety</a>
  </div>
</div>
